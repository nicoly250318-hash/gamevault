<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameVault — Loja Completa de Jogos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset e estilos base */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html, body {
            height: 100%;
            font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(180deg, #0f1724 0%, #071026 100%);
            color: #e6eef8;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            background: linear-gradient(135deg, #7b2cbf, #e76cf6);
            padding: 10px 14px;
            border-radius: 12px;
            font-weight: 700;
        }
        
        .subtitle {
            opacity: .8;
            font-size: 14px;
        }
        
        /* Navigation */
        nav {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        nav a {
            color: inherit;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        nav a:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        nav a.active {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
        }
        
        /* Search & actions */
        .actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search {
            background: rgba(255, 255, 255, 0.04);
            padding: 8px 12px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 380px;
            transition: all 0.2s ease;
        }
        
        .search:focus-within {
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 2px rgba(123, 44, 191, 0.3);
        }
        
        .search input {
            background: transparent;
            border: 0;
            outline: none;
            color: inherit;
            width: 100%;
        }
        
        .btn {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            padding: 8px 14px;
            border-radius: 10px;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(123, 44, 191, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.secondary {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .icon-btn {
            background: transparent;
            border: 0;
            color: inherit;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .icon-btn.active {
            color: #e76cf6;
        }
        
        /* Layout */
        .grid {
            display: grid;
            grid-template-columns: 260px 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        aside {
            background: rgba(255, 255, 255, 0.03);
            padding: 16px;
            border-radius: 12px;
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        
        main {
            min-height: 400px;
        }
        
        /* Filters */
        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .chip {
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.02);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .chip:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .chip.active {
            background: linear-gradient(90deg, #6d28d9, #a78bfa);
            color: white;
        }
        
        /* Sort */
        .row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        
        /* Game grid */
        .store-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.03);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }
        
        .card .meta {
            padding: 10px;
        }
        
        .title {
            font-weight: 700;
        }
        
        .price {
            font-weight: 600;
            margin-top: 8px;
        }
        
        .small {
            font-size: 13px;
            opacity: .8;
        }
        
        .card-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .favorite-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .favorite-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }
        
        .favorite-btn.active {
            color: #e76cf6;
        }
        
        /* Promoções */
        .promo-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: linear-gradient(90deg, #dc2626, #ef4444);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .original-price {
            text-decoration: line-through;
            opacity: 0.7;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .discount {
            color: #10b981;
            font-weight: 700;
            font-size: 12px;
        }
        
        /* Modal / details */
        .modal {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(2, 6, 23, 0.6);
            padding: 20px;
            visibility: hidden;
            opacity: 0;
            transition: opacity .18s;
            z-index: 1000;
        }
        
        .modal.open {
            visibility: visible;
            opacity: 1;
        }
        
        .modal-card {
            background: linear-gradient(180deg, #071427, #0b1b2b);
            width: 900px;
            max-width: 100%;
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            position: relative;
        }
        
        .modal.open .modal-card {
            transform: scale(1);
        }
        
        .modal-left {
            width: 48%;
            float: left;
            padding-right: 12px;
        }
        
        .modal-right {
            width: 52%;
            float: right;
        }
        
        .clear {
            clear: both;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: inherit;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Cart */
        .cart {
            position: fixed;
            right: 18px;
            top: 18px;
            background: linear-gradient(180deg, #0b1220, #071122);
            border-radius: 12px;
            padding: 10px;
            width: 320px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            box-shadow: 0 6px 24px rgba(2, 6, 23, 0.7);
            z-index: 100;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        
        .cart.open {
            transform: translateX(0);
        }
        
        .cart h4 {
            margin-bottom: 8px;
        }
        
        .cart .items {
            max-height: 260px;
            overflow: auto;
        }
        
        .cart .row-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.02);
            transition: all 0.2s ease;
        }
        
        .cart .row-item:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .checkout {
            display: block;
            margin-top: 12px;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            background: linear-gradient(90deg, #059669, #10b981);
            color: #042018;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.2s ease;
        }
        
        .checkout:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.4);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: linear-gradient(90deg, #059669, #10b981);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: inherit;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #7b2cbf;
            box-shadow: 0 0 0 2px rgba(123, 44, 191, 0.2);
        }
        
        .form-row {
            display: flex;
            gap: 12px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            color: #7b2cbf;
            border-bottom-color: #7b2cbf;
        }
        
        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .table th {
            font-weight: 600;
            color: #a5b4fc;
        }
        
        /* Footer */
        footer {
            background: rgba(255, 255, 255, 0.02);
            margin-top: 60px;
            padding: 40px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }
        
        .footer-section h3 {
            margin-bottom: 15px;
            color: #a5b4fc;
        }
        
        .footer-section a {
            display: block;
            color: inherit;
            text-decoration: none;
            margin-bottom: 8px;
            transition: color 0.2s ease;
        }
        
        .footer-section a:hover {
            color: #7b2cbf;
        }
        
        .footer-bottom {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        /* Payment methods */
        .payment-methods {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .payment-method {
            flex: 1;
            text-align: center;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .payment-method:hover {
            border-color: #7b2cbf;
        }
        
        .payment-method.active {
            background: rgba(123, 44, 191, 0.1);
            border-color: #7b2cbf;
        }
        
        /* Star rating */
        .rating {
            display: flex;
            gap: 2px;
            margin-top: 5px;
        }
        
        .star {
            color: #ffd700;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .star:hover {
            transform: scale(1.2);
        }
        
        .user-rating {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }
        
        .rating-stats {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .rating-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            flex: 1;
            overflow: hidden;
        }
        
        .rating-fill {
            height: 100%;
            background: #ffd700;
            border-radius: 3px;
        }
        
        /* Admin login */
        .admin-login {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 12px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        /* Promoções */
        .promo-section {
            background: linear-gradient(90deg, #7b2cbf, #e76cf6);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        
        .promo-section h2 {
            color: white;
            margin-bottom: 10px;
        }
        
        .promo-section p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 15px;
        }
        
        .promo-timer {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin: 10px 0;
        }
        
        /* Cupom */
        .coupon-section {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .coupon-input {
            display: flex;
            gap: 10px;
        }
        
        .coupon-input input {
            flex: 1;
        }
        
        /* Responsivo */
        @media (max-width: 900px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .search {
                width: 220px;
            }
            
            .modal-card {
                width: 95%;
            }
            
            .modal-left, .modal-right {
                width: 100%;
                float: none;
            }
            
            .cart {
                position: fixed;
                right: 0;
                left: 0;
                top: auto;
                bottom: 0;
                width: 100%;
                border-radius: 12px 12px 0 0;
                transform: translateY(100%);
            }
            
            .cart.open {
                transform: translateY(0);
            }
            
            header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .actions {
                width: 100%;
                justify-content: space-between;
            }
            
            nav {
                flex-wrap: wrap;
            }
        }
        
        /* small touches */
        .muted {
            opacity: .75;
            font-size: 13px;
        }
        
        .badge {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.03);
        }
        
        .filter-section {
            margin-top: 18px;
        }
        
        .price-range {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        
        .price-range input {
            width: 48%;
        }
        
        .rating-filter {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .rating-btn {
            padding: 6px 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.02);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .rating-btn:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .rating-btn.active {
            background: linear-gradient(90deg, #6d28d9, #a78bfa);
            color: white;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                opacity: 1;
            }
        }
        
        /* Admin */
        .admin-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.7;
        }
        
        /* Páginas */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="brand">
                <div class="logo">GameVault</div>
                <div>
                    <div style="font-weight:700">GameVault — Loja Completa de Jogos</div>
                    <div class="subtitle">Sua loja completa de jogos digitais</div>
                </div>
            </div>

            <div class="actions">
                <div class="search">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 21l-4.35-4.35"/>
                        <circle cx="11" cy="11" r="6"/>
                    </svg>
                    <input id="search-input" placeholder="Pesquisar jogos, estúdios, tags...">
                </div>
                <button class="icon-btn" id="favBtn" title="Favoritos">❤</button>
                <button class="icon-btn" id="accountBtn" title="Minha Conta"><i class="fas fa-user"></i></button>
                <button class="icon-btn" id="historyBtn" title="Histórico"><i class="fas fa-history"></i></button>
                <button class="btn" id="openCart">Carrinho (<span id="cartCount">0</span>)</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav>
            <a href="#" class="nav-link active" data-page="home">Início</a>
            <a href="#" class="nav-link" data-page="store">Loja</a>
            <a href="#" class="nav-link" data-page="favorites">Favoritos</a>
            <a href="#" class="nav-link" data-page="history">Histórico</a>
            <a href="#" class="nav-link" data-page="account">Minha Conta</a>
            <a href="#" class="nav-link" data-page="admin">Admin</a>
        </nav>

        <!-- Páginas -->
        <div id="pages">
            <!-- Página Inicial -->
            <div id="home-page" class="page active">
                <!-- Seção de promoções -->
                <div class="promo-section">
                    <h2>PROMOÇÃO DE VERÃO</h2>
                    <p>Descontos de até 70% em jogos selecionados. Oferta por tempo limitado!</p>
                    <div class="promo-timer" id="promoTimer">05:00:00</div>
                    <button class="btn" id="view-offers-btn">Ver Ofertas</button>
                </div>
                
                <div class="section">
                    <h2 class="section-title">Bem-vindo ao GameVault</h2>
                    <p>Encontre os melhores jogos digitais com os melhores preços. Explore nossa coleção e aproveite ofertas exclusivas!</p>
                    
                    <div class="store-grid" style="margin-top:30px">
                        <div class="card">
                            <img src="https://images.unsplash.com/photo-1542751371-adc38448a05e?w=1200&q=80" alt="Destaque 1">
                            <div class="meta">
                                <div class="title">Ofertas da Semana</div>
                                <div class="small muted">Descontos de até 70%</div>
                                <div class="price">A partir de R$ 9,99</div>
                            </div>
                        </div>
                        <div class="card">
                            <img src="https://images.unsplash.com/photo-1511512578047-dfb367046420?w=1200&q=80" alt="Destaque 2">
                            <div class="meta">
                                <div class="title">Lançamentos</div>
                                <div class="small muted">Jogos recém-lançados</div>
                                <div class="price">Confira agora</div>
                            </div>
                        </div>
                        <div class="card">
                            <img src="https://images.unsplash.com/photo-1534423861386-85a16f5d13fd?w=1200&q=80" alt="Destaque 3">
                            <div class="meta">
                                <div class="title">Pré-vendas</div>
                                <div class="small muted">Garanta já os próximos lançamentos</div>
                                <div class="price">Reserve agora</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Seção de jogos em promoção -->
                <div class="section">
                    <h2 class="section-title">Jogos em Promoção</h2>
                    <div id="promo-games" class="store-grid"></div>
                </div>
            </div>

            <!-- Página Loja -->
            <div id="store-page" class="page">
                <div class="grid">
                    <aside>
                        <div class="row">
                            <div>
                                <div style="font-weight:700">Filtros</div>
                                <div class="muted">Selecione um gênero</div>
                            </div>
                            <div class="badge" id="clearFilters" style="cursor:pointer">Limpar</div>
                        </div>

                        <div class="chips" id="genres"></div>

                        <div class="filter-section">
                            <div style="font-weight:700">Preço</div>
                            <div class="price-range">
                                <input type="number" id="minPrice" placeholder="Mín" min="0" step="0.01" class="form-control">
                                <input type="number" id="maxPrice" placeholder="Máx" min="0" step="0.01" class="form-control">
                            </div>
                        </div>

                        <div class="filter-section">
                            <div style="font-weight:700">Avaliação</div>
                            <div class="rating-filter" id="ratings">
                                <div class="rating-btn" data-rating="4.5">4.5+</div>
                                <div class="rating-btn" data-rating="4.0">4.0+</div>
                                <div class="rating-btn" data-rating="3.5">3.5+</div>
                            </div>
                        </div>
                        
                        <div class="filter-section">
                            <div style="font-weight:700">Promoções</div>
                            <div class="chips">
                                <div class="chip active" data-promo="all">Todos</div>
                                <div class="chip" data-promo="discount">Com desconto</div>
                            </div>
                        </div>

                        <div class="filter-section">
                            <div style="font-weight:700">Ordenar</div>
                            <select id="sort" class="form-control">
                                <option value="relevance">Relevância</option>
                                <option value="price-asc">Preço: menor</option>
                                <option value="price-desc">Preço: maior</option>
                                <option value="rating">Melhor avaliação</option>
                                <option value="title">Título (A-Z)</option>
                                <option value="discount">Maior desconto</option>
                            </select>
                        </div>
                    </aside>

                    <main>
                        <div class="row">
                            <div>
                                <h2>Jogos em Destaque</h2>
                                <div class="muted">Procure, filtre e adicione ao carrinho</div>
                            </div>
                            <div class="muted" id="resultsCount"></div>
                        </div>
                        
                        <!-- Cupom de desconto -->
                        <div class="coupon-section">
                            <div style="font-weight:700;margin-bottom:8px">Cupom de Desconto</div>
                            <div class="coupon-input">
                                <input type="text" id="couponCode" placeholder="Digite seu cupom" class="form-control">
                                <button class="btn" id="applyCoupon">Aplicar</button>
                            </div>
                            <div id="couponMessage" class="muted" style="margin-top:5px"></div>
                        </div>

                        <div id="store" class="store-grid"></div>
                    </main>
                </div>
            </div>

            <!-- Página Favoritos -->
            <div id="favorites-page" class="page">
                <h2 class="section-title">Meus Favoritos</h2>
                <div id="favorites-list" class="store-grid"></div>
            </div>

            <!-- Página Histórico -->
            <div id="history-page" class="page">
                <h2 class="section-title">Histórico de Compras</h2>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Pedido</th>
                                <th>Jogos</th>
                                <th>Total</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="history-list">
                            <!-- Histórico será preenchido via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Página Minha Conta -->
            <div id="account-page" class="page">
                <div class="tabs">
                    <div class="tab active" data-tab="login">Login</div>
                    <div class="tab" data-tab="register">Criar Conta</div>
                    <div class="tab" data-tab="profile">Meu Perfil</div>
                </div>

                <div id="login-tab" class="tab-content active">
                    <h2 class="section-title">Fazer Login</h2>
                    <form id="login-form">
                        <div class="form-group">
                            <label for="login-email">E-mail</label>
                            <input type="email" id="login-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password">Senha</label>
                            <input type="password" id="login-password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn">Entrar</button>
                    </form>
                </div>

                <div id="register-tab" class="tab-content">
                    <h2 class="section-title">Criar Conta</h2>
                    <form id="register-form">
                        <div class="form-group">
                            <label for="register-name">Nome Completo</label>
                            <input type="text" id="register-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="register-email">E-mail</label>
                            <input type="email" id="register-email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="register-password">Senha</label>
                            <input type="password" id="register-password" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="register-confirm">Confirmar Senha</label>
                            <input type="password" id="register-confirm" class="form-control" required>
                        </div>
                        <button type="submit" class="btn">Criar Conta</button>
                    </form>
                </div>

                <div id="profile-tab" class="tab-content">
                    <h2 class="section-title">Meu Perfil</h2>
                    <div id="profile-info">
                        <!-- Informações do perfil serão preenchidas via JS -->
                    </div>
                </div>
            </div>

            <!-- Página Admin -->
            <div id="admin-page" class="page">
                <div id="admin-login" class="admin-login">
                    <h2 class="section-title">Acesso Administrativo</h2>
                    <form id="admin-login-form">
                        <div class="form-group">
                            <label for="admin-password">Senha de Administrador</label>
                            <input type="password" id="admin-password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn">Acessar Painel</button>
                    </form>
                </div>

                <div id="admin-panel" style="display:none">
                    <h2 class="section-title">Painel Administrativo</h2>
                    
                    <!-- Estatísticas -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total de Jogos</div>
                            <div class="stat-value" id="admin-total-games">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total de Usuários</div>
                            <div class="stat-value" id="admin-total-users">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total de Pedidos</div>
                            <div class="stat-value" id="admin-total-orders">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Receita Total</div>
                            <div class="stat-value" id="admin-total-revenue">R$ 0,00</div>
                        </div>
                    </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="products">Gerenciar Produtos</div>
                        <div class="tab" data-tab="orders">Pedidos</div>
                        <div class="tab" data-tab="users">Usuários</div>
                        <div class="tab" data-tab="promotions">Promoções</div>
                    </div>

                    <div id="products-tab" class="tab-content active">
                        <div class="admin-actions">
                            <h3>Gerenciar Jogos</h3>
                            <button class="btn" id="add-game-btn">Adicionar Jogo</button>
                            <button class="btn secondary" id="export-games">Exportar Dados</button>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Imagem</th>
                                        <th>Título</th>
                                        <th>Gênero</th>
                                        <th>Preço</th>
                                        <th>Desconto</th>
                                        <th>Avaliação</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-games-list">
                                    <!-- Lista de jogos será preenchida via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="orders-tab" class="tab-content">
                        <h3>Pedidos</h3>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cliente</th>
                                        <th>Data</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-orders-list">
                                    <!-- Lista de pedidos será preenchida via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="users-tab" class="tab-content">
                        <h3>Usuários</h3>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nome</th>
                                        <th>E-mail</th>
                                        <th>Data de Registro</th>
                                        <th>Total Gasto</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-users-list">
                                    <!-- Lista de usuários será preenchida via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="promotions-tab" class="tab-content">
                        <div class="admin-actions">
                            <h3>Gerenciar Promoções</h3>
                            <button class="btn" id="add-promo-btn">Criar Promoção</button>
                        </div>
                        
                        <div class="form-group">
                            <label for="promo-name">Nome da Promoção</label>
                            <input type="text" id="promo-name" class="form-control" placeholder="Ex: Promoção de Verão">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="promo-discount">Desconto (%)</label>
                                <input type="number" id="promo-discount" class="form-control" min="1" max="100" placeholder="Ex: 20">
                            </div>
                            <div class="form-group">
                                <label for="promo-games">Jogos (IDs separados por vírgula)</label>
                                <input type="text" id="promo-games" class="form-control" placeholder="Ex: 1,3,5,7">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="promo-start">Data de Início</label>
                                <input type="datetime-local" id="promo-start" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="promo-end">Data de Término</label>
                                <input type="datetime-local" id="promo-end" class="form-control">
                            </div>
                        </div>
                        
                        <button class="btn" id="save-promo">Salvar Promoção</button>
                        
                        <h4 style="margin-top:20px">Promoções Ativas</h4>
                        <div id="active-promotions" class="store-grid" style="margin-top:15px">
                            <!-- Promoções ativas serão listadas aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h3>GameVault</h3>
                    <p>Sua loja completa de jogos digitais com os melhores preços e ofertas exclusivas.</p>
                </div>
                <div class="footer-section">
                    <h3>Links Rápidos</h3>
                    <a href="#" data-page="home">Início</a>
                    <a href="#" data-page="store">Loja</a>
                    <a href="#" data-page="favorites">Favoritos</a>
                    <a href="#" data-page="account">Minha Conta</a>
                </div>
                <div class="footer-section">
                    <h3>Suporte</h3>
                    <a href="#">Central de Ajuda</a>
                    <a href="#">Política de Reembolso</a>
                    <a href="#">Termos de Uso</a>
                    <a href="#">Política de Privacidade</a>
                </div>
                <div class="footer-section">
                    <h3>Contato</h3>
                    <p>Email: suporte@gamevault.com</p>
                    <p>Telefone: (11) 9999-9999</p>
                    <div style="display:flex;gap:10px;margin-top:10px">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 GameVault. Todos os direitos reservados.</p>
            </div>
        </footer>

        <!-- Cart flutuante -->
        <div id="cart" class="cart">
            <button class="close-btn" id="closeCart">×</button>
            <h4>Carrinho</h4>
            <div class="items" id="cartItems"></div>
            <div class="coupon-section" style="margin:10px 0">
                <div class="coupon-input">
                    <input type="text" id="cart-coupon" placeholder="Cupom de desconto" class="form-control">
                    <button class="btn" id="apply-cart-coupon">Aplicar</button>
                </div>
                <div id="cart-coupon-message" class="muted" style="margin-top:5px"></div>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
                <div>
                    <div class="muted">Total</div>
                    <div id="cartTotal" style="font-weight:700">R$ 0.00</div>
                    <div id="cartDiscount" style="color:#10b981;font-size:12px"></div>
                </div>
                <button class="checkout" id="checkoutBtn">Finalizar Compra</button>
            </div>
        </div>

        <!-- Modal detalhe -->
        <div id="modal" class="modal">
            <div class="modal-card">
                <button class="close-btn" id="closeModal">×</button>
                <div class="modal-left">
                    <img id="modalImg" src="" alt="capa" style="width:100%;height:220px;object-fit:cover;border-radius:8px" />
                    <div style="margin-top:12px;display:flex;gap:8px">
                        <button class="btn" id="modalBuy">Adicionar ao carrinho</button>
                        <button class="icon-btn" id="modalFav">❤</button>
                    </div>
                    
                    <!-- Avaliação do usuário -->
                    <div class="user-rating" id="userRatingSection" style="display:none">
                        <h4>Sua Avaliação</h4>
                        <div class="rating" id="userRatingStars">
                            <span class="star" data-rating="1">★</span>
                            <span class="star" data-rating="2">★</span>
                            <span class="star" data-rating="3">★</span>
                            <span class="star" data-rating="4">★</span>
                            <span class="star" data-rating="5">★</span>
                        </div>
                        <div id="userRatingText" class="muted" style="margin-top:5px">Clique nas estrelas para avaliar</div>
                    </div>
                </div>
                <div class="modal-right">
                    <div style="display:flex;justify-content:space-between;align-items:start;gap:12px">
                        <div>
                            <h3 id="modalTitle"></h3>
                            <div class="muted" id="modalGenre"></div>
                        </div>
                        <div style="text-align:right">
                            <div style="font-weight:800;font-size:18px" id="modalPrice"></div>
                            <div id="modalDiscount" style="color:#10b981;font-size:14px"></div>
                            <div class="muted">Avaliação: <span id="modalRating"></span></div>
                        </div>
                    </div>

                    <div style="margin-top:12px" id="modalDesc"></div>
                    
                    <!-- Estatísticas de avaliação -->
                    <div id="ratingStats" style="margin-top:15px">
                        <h4>Avaliações dos Usuários</h4>
                        <div id="ratingBars">
                            <!-- Barras de avaliação serão preenchidas via JS -->
                        </div>
                        <div id="ratingCount" class="muted" style="margin-top:5px"></div>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
        </div>

        <!-- Modal Checkout -->
        <div id="checkout-modal" class="modal">
            <div class="modal-card" style="max-width:600px">
                <button class="close-btn" id="closeCheckout">×</button>
                <h3 style="margin-bottom:20px">Finalizar Compra</h3>
                
                <div class="tabs">
                    <div class="tab active" data-tab="address">Endereço</div>
                    <div class="tab" data-tab="payment">Pagamento</div>
                    <div class="tab" data-tab="review">Revisão</div>
                </div>
                
                <div id="address-tab" class="tab-content active">
                    <form id="address-form">
                        <div class="form-group">
                            <label for="full-name">Nome Completo</label>
                            <input type="text" id="full-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="cep">CEP</label>
                            <input type="text" id="cep" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="address">Endereço</label>
                            <input type="text" id="address" class="form-control" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="number">Número</label>
                                <input type="text" id="number" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="complement">Complemento</label>
                                <input type="text" id="complement" class="form-control">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="neighborhood">Bairro</label>
                                <input type="text" id="neighborhood" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="city">Cidade</label>
                                <input type="text" id="city" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="state">Estado</label>
                            <select id="state" class="form-control" required>
                                <option value="">Selecione</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                        <div style="display:flex;justify-content:space-between;margin-top:20px">
                            <button type="button" class="btn secondary" id="cancel-checkout">Cancelar</button>
                            <button type="button" class="btn" id="next-to-payment">Próximo</button>
                        </div>
                    </form>
                </div>
                
                <div id="payment-tab" class="tab-content">
                    <h4>Selecione a Forma de Pagamento</h4>
                    <div class="payment-methods">
                        <div class="payment-method active" data-method="credit">
                            <i class="fas fa-credit-card" style="font-size:24px;margin-bottom:5px"></i>
                            <div>Cartão de Crédito</div>
                        </div>
                        <div class="payment-method" data-method="pix">
                            <i class="fas fa-qrcode" style="font-size:24px;margin-bottom:5px"></i>
                            <div>PIX</div>
                        </div>
                        <div class="payment-method" data-method="boleto">
                            <i class="fas fa-barcode" style="font-size:24px;margin-bottom:5px"></i>
                            <div>Boleto</div>
                        </div>
                    </div>
                    
                    <div id="credit-card-form" style="margin-top:20px">
                        <div class="form-group">
                            <label for="card-number">Número do Cartão</label>
                            <input type="text" id="card-number" class="form-control" placeholder="1234 5678 9012 3456">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="card-expiry">Validade</label>
                                <input type="text" id="card-expiry" class="form-control" placeholder="MM/AA">
                            </div>
                            <div class="form-group">
                                <label for="card-cvc">CVC</label>
                                <input type="text" id="card-cvc" class="form-control" placeholder="123">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="card-name">Nome no Cartão</label>
                            <input type="text" id="card-name" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="card-cpf">CPF do Titular</label>
                            <input type="text" id="card-cpf" class="form-control">
                        </div>
                    </div>
                    
                    <div style="display:flex;justify-content:space-between;margin-top:20px">
                        <button type="button" class="btn secondary" id="back-to-address">Voltar</button>
                        <button type="button" class="btn" id="next-to-review">Próximo</button>
                    </div>
                </div>
                
                <div id="review-tab" class="tab-content">
                    <h4>Revisão do Pedido</h4>
                    <div id="review-items" style="margin-bottom:20px"></div>
                    <div style="border-top:1px solid rgba(255,255,255,0.1);padding-top:10px">
                        <div style="display:flex;justify-content:space-between">
                            <div>Subtotal:</div>
                            <div id="review-subtotal">R$ 0.00</div>
                        </div>
                        <div style="display:flex;justify-content:space-between">
                            <div>Desconto:</div>
                            <div id="review-discount" style="color:#10b981">- R$ 0.00</div>
                        </div>
                        <div style="display:flex;justify-content:space-between;font-weight:bold;margin-top:5px">
                            <div>Total:</div>
                            <div id="review-total">R$ 0.00</div>
                        </div>
                    </div>
                    
                    <div style="display:flex;justify-content:space-between;margin-top:20px">
                        <button type="button" class="btn secondary" id="back-to-payment">Voltar</button>
                        <button type="button" class="btn" id="confirm-purchase">Confirmar Compra</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" class="toast"></div>
    </div>

    <script>
        // Dados de demo expandidos
        const GAMES = [
            {id:1,title:'Chronicles of Ember',price:24.99,originalPrice:49.99,genre:'RPG',rating:4.6,img:'https://images.unsplash.com/photo-1542751371-adc38448a05e?w=1200&q=80',desc:'RPG de mundo aberto com combates táticos e narrativa ramificada. Explore um mundo vasto repleto de mistérios e desafios.',onSale:true},
            {id:2,title:'Neon Drift',price:14.99,genre:'Corrida',rating:4.2,img:'https://images.unsplash.com/photo-1503376780353-7e6692767b70?w=1200&q=80',desc:'Corridas futuristas com drift e trilha synthwave. Personalize seu veículo e domine as pistas em ambientes cyberpunk.'},
            {id:3,title:'Skyforge: Lost Isles',price:9.99,originalPrice:19.99,genre:'Aventura',rating:4.0,img:'https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=1200&q=80',desc:'Exploração em ilhas flutuantes. Desvende os segredos de uma civilização antiga e sobreviva aos perigos das ilhas.',onSale:true},
            {id:4,title:'Factory Tycoon',price:7.5,genre:'Simulação',rating:3.9,img:'https://images.unsplash.com/photo-1526378724077-4f5d6b2d6b0b?w=1200&q=80',desc:'Construa e otimize sua cadeia de produção. Gerencie recursos, funcionários e expanda seu império industrial.'},
            {id:5,title:'Shadow Operatives',price:29.99,genre:'Ação',rating:4.8,img:'https://images.unsplash.com/photo-1510070009289-b5bc34383727?w=1200&q=80',desc:'Ação tática furtiva com coop. Infiltre-se em bases inimigas e execute missões de alto risco com sua equipe.'},
            {id:6,title:'Cyber Nexus',price:19.99,originalPrice:39.99,genre:'RPG',rating:4.5,img:'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=1200&q=80',desc:'RPG cyberpunk com elementos de hacking e personalização profunda de personagens.',onSale:true},
            {id:7,title:'Galaxy Raiders',price:12.99,genre:'Aventura',rating:4.1,img:'https://images.unsplash.com/photo-1446776877081-d282a0f896e2?w=1200&q=80',desc:'Explore sistemas estelares, descubra planetas alienígenas e lute contra piratas espaciais.'},
            {id:8,title:'Mythic Legends',price:22.99,genre:'RPG',rating:4.7,img:'https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=1200&q=80',desc:'RPG de fantasia épica com batalhas estratégicas e um mundo rico em lore e personagens memoráveis.'},
            {id:9,title:'Urban Outlaws',price:15.99,originalPrice:29.99,genre:'Ação',rating:4.3,img:'https://images.unsplash.com/photo-1534423861386-85a16f5d13fd?w=1200&q=80',desc:'Ação em mundo aberto com parkour, combate fluido e uma narrativa sobre redenção e vingança.',onSale:true},
            {id:10,title:'Farm Life Simulator',price:8.99,genre:'Simulação',rating:3.8,img:'https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=1200&q=80',desc:'Cultive, crie animais e construa a fazenda dos seus sonhos neste relaxante simulador de vida rural.'},
            {id:11,title:'Racing Revolution',price:17.99,genre:'Corrida',rating:4.4,img:'https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?w=1200&q=80',desc:'Corridas realistas com física avançada, modos multiplayer e uma ampla variedade de veículos e pistas.'},
            {id:12,title:'Space Engineers',price:21.99,originalPrice:43.99,genre:'Simulação',rating:4.2,img:'https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?w=1200&q=80',desc:'Construa e pilote naves espaciais, estações e veículos em um ambiente de sandbox espacial.',onSale:true},
            {id:13,title:'Zombie Survival',price:11.99,genre:'Ação',rating:3.7,img:'https://images.unsplash.com/photo-1534423861386-85a16f5d13fd?w=1200&q=80',desc:'Sobreviva a hordas de zumbis em um mundo pós-apocalíptico. Construa bases, colete recursos e lute para sobreviver.'},
            {id:14,title:'Fantasy Kingdoms',price:27.99,originalPrice:55.99,genre:'RPG',rating:4.9,img:'https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=1200&q=80',desc:'Construa e expanda seu reino em um mundo de fantasia épica. Alie-se com outras facções e domine o continente.',onSale:true},
            {id:15,title:'Sports Arena',price:19.99,genre:'Esportes',rating:4.0,img:'https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?w=1200&q=80',desc:'Experimente a emoção de diversos esportes em um único jogo. Modos singleplayer e multiplayer disponíveis.'}
        ];

        // Cupons de desconto
        const COUPONS = [
            {code: 'VERAO10', discount: 10, minValue: 50, valid: true},
            {code: 'GAMER20', discount: 20, minValue: 100, valid: true},
            {code: 'LANCAMENTO15', discount: 15, minValue: 30, valid: true}
        ];

        // Promoções ativas
        let PROMOTIONS = JSON.parse(localStorage.getItem('promotions_demo') || '[]');

        // Adicionar avaliações detalhadas aos jogos
        GAMES.forEach(game => {
            game.ratings = JSON.parse(localStorage.getItem(`game_ratings_${game.id}`) || '[]');
            game.userRatings = game.ratings.length;
            game.rating = game.ratings.length > 0 
                ? (game.ratings.reduce((a, b) => a + b, 0) / game.ratings.length).toFixed(1)
                : game.rating;
        });

        /* Estado */
        let state = {
            q: '',
            genre: 'All',
            sort: 'relevance',
            minPrice: null,
            maxPrice: null,
            minRating: null,
            showOnSale: false,
            favorites: JSON.parse(localStorage.getItem('favorites_demo')||'[]'),
            cart: JSON.parse(localStorage.getItem('cart_demo')||'[]'),
            showFavorites: false,
            currentUser: JSON.parse(localStorage.getItem('current_user')||'null'),
            users: JSON.parse(localStorage.getItem('users_demo')||'[]'),
            orders: JSON.parse(localStorage.getItem('orders_demo')||'[]'),
            currentPage: 'home',
            checkoutStep: 'address',
            adminPassword: '110613', // Nova senha do admin
            adminLoggedIn: false,
            currentGameRating: 0,
            appliedCoupon: null,
            cartDiscount: 0,
            promoTimeRemaining: parseInt(localStorage.getItem('promo_time_remaining') || (5 * 60 * 60)) // 5 horas em segundos
        };

        // Utilitários DOM
        const el = s => document.querySelector(s);
        const elAll = s => document.querySelectorAll(s);

        /* Inicialização */
        function init() {
            renderGenres();
            renderStore();
            bindUI();
            renderCart();
            showPage('home');
            startPromoTimer();
            renderPromoGames();
        }

        function renderGenres() {
            const genres = ['All', ...new Set(GAMES.map(g => g.genre))];
            const wrap = el('#genres');
            wrap.innerHTML = '';
            
            genres.forEach(g => {
                const b = document.createElement('button');
                b.className = 'chip' + (state.genre === g ? ' active' : '');
                b.textContent = g;
                b.onclick = () => {
                    state.genre = g;
                    renderGenres();
                    renderStore();
                };
                wrap.appendChild(b);
            });
        }

        function filterAndSort() {
            let res = GAMES.filter(g => {
                // Filtro por gênero
                const matchGenre = state.genre === 'All' || g.genre === state.genre;
                
                // Filtro por busca
                const q = state.q.trim().toLowerCase();
                const matchQuery = !q || 
                    g.title.toLowerCase().includes(q) || 
                    g.desc.toLowerCase().includes(q) ||
                    g.genre.toLowerCase().includes(q);
                
                // Filtro por preço
                const matchMinPrice = state.minPrice === null || g.price >= parseFloat(state.minPrice);
                const matchMaxPrice = state.maxPrice === null || g.price <= parseFloat(state.maxPrice);
                
                // Filtro por avaliação
                const matchRating = state.minRating === null || parseFloat(g.rating) >= parseFloat(state.minRating);
                
                // Filtro por favoritos
                const matchFavorites = !state.showFavorites || state.favorites.includes(g.id);
                
                // Filtro por promoção
                const matchPromo = !state.showOnSale || g.onSale;
                
                return matchGenre && matchQuery && matchMinPrice && matchMaxPrice && matchRating && matchFavorites && matchPromo;
            });

            // Ordenação
            if (state.sort === 'price-asc') res.sort((a, b) => a.price - b.price);
            if (state.sort === 'price-desc') res.sort((a, b) => b.price - a.price);
            if (state.sort === 'rating') res.sort((a, b) => parseFloat(b.rating) - parseFloat(a.rating));
            if (state.sort === 'title') res.sort((a, b) => a.title.localeCompare(b.title));
            if (state.sort === 'discount') {
                res.sort((a, b) => {
                    const aDiscount = a.originalPrice ? ((a.originalPrice - a.price) / a.originalPrice * 100) : 0;
                    const bDiscount = b.originalPrice ? ((b.originalPrice - b.price) / b.originalPrice * 100) : 0;
                    return bDiscount - aDiscount;
                });
            }

            return res;
        }

        function renderStore() {
            const wrap = el('#store'); 
            wrap.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:200px"><div class="loading"></div></div>';
            
            // Simular carregamento
            setTimeout(() => {
                wrap.innerHTML = '';
                const list = filterAndSort();
                
                // Atualizar contador de resultados
                el('#resultsCount').textContent = `${list.length} jogo${list.length !== 1 ? 's' : ''} encontrado${list.length !== 1 ? 's' : ''}`;
                
                if (list.length === 0) {
                    wrap.innerHTML = '<div class="muted" style="text-align:center;padding:40px">Nenhum jogo encontrado com os filtros atuais.</div>'; 
                    return;
                }
                
                list.forEach(g => {
                    const discount = g.originalPrice ? Math.round(((g.originalPrice - g.price) / g.originalPrice) * 100) : 0;
                    
                    const c = document.createElement('div'); 
                    c.className = 'card';
                    c.innerHTML = `
                        ${g.onSale ? `<div class="promo-badge">-${discount}%</div>` : ''}
                        <button class="favorite-btn ${state.favorites.includes(g.id) ? 'active' : ''}" data-fav="${g.id}">
                            ❤
                        </button>
                        <img src="${g.img}" alt="${g.title}">
                        <div class="meta">
                            <div class="title">${g.title}</div>
                            <div class="small muted">${g.genre} · ${renderStars(g.rating)} ${g.rating}</div>
                            <div class="price">
                                ${g.originalPrice ? `<span class="original-price">R$ ${g.originalPrice.toFixed(2)}</span>` : ''}
                                R$ ${g.price.toFixed(2)}
                                ${g.originalPrice ? `<div class="discount">-${discount}%</div>` : ''}
                            </div>
                            <div class="card-actions">
                                <button class="btn" data-id="${g.id}">Adicionar</button>
                                <button class="icon-btn" data-view="${g.id}">Ver</button>
                            </div>
                        </div>
                    `;
                    wrap.appendChild(c);
                });
            }, 300);
        }

        function renderPromoGames() {
            const wrap = el('#promo-games');
            wrap.innerHTML = '';
            
            const promoGames = GAMES.filter(g => g.onSale).slice(0, 6);
            
            if (promoGames.length === 0) {
                wrap.innerHTML = '<div class="muted" style="text-align:center;padding:40px">Nenhum jogo em promoção no momento.</div>';
                return;
            }
            
            promoGames.forEach(g => {
                const discount = g.originalPrice ? Math.round(((g.originalPrice - g.price) / g.originalPrice) * 100) : 0;
                
                const c = document.createElement('div'); 
                c.className = 'card';
                c.innerHTML = `
                    <div class="promo-badge">-${discount}%</div>
                    <button class="favorite-btn ${state.favorites.includes(g.id) ? 'active' : ''}" data-fav="${g.id}">
                        ❤
                    </button>
                    <img src="${g.img}" alt="${g.title}">
                    <div class="meta">
                        <div class="title">${g.title}</div>
                        <div class="small muted">${g.genre} · ${renderStars(g.rating)} ${g.rating}</div>
                        <div class="price">
                            <span class="original-price">R$ ${g.originalPrice.toFixed(2)}</span>
                            R$ ${g.price.toFixed(2)}
                            <div class="discount">-${discount}%</div>
                        </div>
                        <div class="card-actions">
                            <button class="btn" data-id="${g.id}">Adicionar</button>
                            <button class="icon-btn" data-view="${g.id}">Ver</button>
                        </div>
                    </div>
                `;
                wrap.appendChild(c);
            });
        }

        function renderStars(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '★';
            }
            
            if (halfStar) {
                stars += '½';
            }
            
            const emptyStars = 5 - Math.ceil(rating);
            for (let i = 0; i < emptyStars; i++) {
                stars += '☆';
            }
            
            return stars;
        }

        function bindUI() {
            // Busca
            el('#search-input').addEventListener('input', e => {
                state.q = e.target.value;
                renderStore();
            });
            
            // Ordenação
            el('#sort').addEventListener('change', e => {
                state.sort = e.target.value;
                renderStore();
            });
            
            // Filtros
            el('#clearFilters').addEventListener('click', () => {
                state.genre = 'All'; 
                state.minPrice = null;
                state.maxPrice = null;
                state.minRating = null;
                state.showFavorites = false;
                state.showOnSale = false;
                el('#minPrice').value = '';
                el('#maxPrice').value = '';
                elAll('.rating-btn').forEach(btn => btn.classList.remove('active'));
                elAll('.chip[data-promo]').forEach(chip => {
                    if (chip.dataset.promo === 'all') chip.classList.add('active');
                    else chip.classList.remove('active');
                });
                el('#favBtn').classList.remove('active');
                renderGenres(); 
                renderStore();
            });

            // Filtro de preço
            el('#minPrice').addEventListener('input', e => {
                state.minPrice = e.target.value;
                renderStore();
            });
            
            el('#maxPrice').addEventListener('input', e => {
                state.maxPrice = e.target.value;
                renderStore();
            });

            // Filtro de avaliação
            elAll('.rating-btn').forEach(btn => {
                btn.addEventListener('click', e => {
                    const rating = parseFloat(e.target.dataset.rating);
                    state.minRating = state.minRating === rating ? null : rating;
                    elAll('.rating-btn').forEach(b => b.classList.remove('active'));
                    if (state.minRating) e.target.classList.add('active');
                    renderStore();
                });
            });

            // Filtro de promoções
            elAll('.chip[data-promo]').forEach(chip => {
                chip.addEventListener('click', e => {
                    const promo = e.target.dataset.promo;
                    state.showOnSale = promo === 'discount';
                    elAll('.chip[data-promo]').forEach(c => c.classList.remove('active'));
                    e.target.classList.add('active');
                    renderStore();
                });
            });

            // Botão de favoritos
            el('#favBtn').addEventListener('click', e => {
                state.showFavorites = !state.showFavorites;
                e.target.classList.toggle('active', state.showFavorites);
                renderStore();
            });

            // Delegation para botões adicionar / ver / favoritar
            el('#store').addEventListener('click', e => {
                const id = e.target.dataset.id || e.target.dataset.view || e.target.dataset.fav;
                if (!id) return;
                const game = GAMES.find(g => g.id == id);
                
                if (e.target.dataset.id) { 
                    addToCart(game); 
                }
                if (e.target.dataset.view) { 
                    openModal(game); 
                }
                if (e.target.dataset.fav) { 
                    toggleFavorite(game.id); 
                    e.target.classList.toggle('active');
                }
            });

            // Cupom de desconto
            el('#applyCoupon').addEventListener('click', applyCoupon);
            el('#apply-cart-coupon').addEventListener('click', applyCartCoupon);

            // Carrinho
            el('#openCart').addEventListener('click', () => { toggleCart(); });
            el('#closeCart').addEventListener('click', () => { toggleCart(); });
            
            // Modal
            el('#closeModal').addEventListener('click', closeModal);
            el('#modalBuy').addEventListener('click', () => { 
                const id = el('#modalBuy').dataset.id; 
                const game = GAMES.find(g => g.id == id); 
                addToCart(game); 
            });
            el('#modalFav').addEventListener('click', () => { 
                const id = el('#modalBuy').dataset.id; 
                toggleFavorite(parseInt(id));
                el('#modalFav').classList.toggle('active');
            });
            
            // Checkout
            el('#checkoutBtn').addEventListener('click', () => { 
                if (state.cart.length === 0) {
                    showToast('Seu carrinho está vazio!');
                    return;
                }
                openCheckout();
            });
            
            // Botão X para fechar checkout
            el('#closeCheckout').addEventListener('click', closeCheckout);

            // Navegação
            elAll('.nav-link').forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    const page = e.target.dataset.page;
                    showPage(page);
                    
                    // Atualizar navegação ativa
                    elAll('.nav-link').forEach(l => l.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });

            // Botão para ver ofertas
            el('#view-offers-btn').addEventListener('click', () => {
                showPage('store');
                elAll('.nav-link').forEach(l => l.classList.remove('active'));
                el('.nav-link[data-page="store"]').classList.add('active');
            });

            // Tabs da conta
            elAll('#account-page .tab').forEach(tab => {
                tab.addEventListener('click', e => {
                    const tabName = e.target.dataset.tab;
                    switchAccountTab(tabName);
                });
            });

            // Tabs do admin
            elAll('#admin-page .tab').forEach(tab => {
                tab.addEventListener('click', e => {
                    const tabName = e.target.dataset.tab;
                    switchAdminTab(tabName);
                });
            });

            // Tabs do checkout
            elAll('#checkout-modal .tab').forEach(tab => {
                tab.addEventListener('click', e => {
                    const tabName = e.target.dataset.tab;
                    switchCheckoutTab(tabName);
                });
            });

            // Formulários de login e registro
            el('#login-form').addEventListener('submit', handleLogin);
            el('#register-form').addEventListener('submit', handleRegister);
            el('#admin-login-form').addEventListener('submit', handleAdminLogin);

            // Botões do checkout
            el('#next-to-payment').addEventListener('click', () => switchCheckoutTab('payment'));
            el('#back-to-address').addEventListener('click', () => switchCheckoutTab('address'));
            el('#next-to-review').addEventListener('click', () => switchCheckoutTab('review'));
            el('#back-to-payment').addEventListener('click', () => switchCheckoutTab('payment'));
            el('#cancel-checkout').addEventListener('click', closeCheckout);
            el('#confirm-purchase').addEventListener('click', confirmPurchase);

            // Métodos de pagamento
            elAll('.payment-method').forEach(method => {
                method.addEventListener('click', e => {
                    elAll('.payment-method').forEach(m => m.classList.remove('active'));
                    e.target.closest('.payment-method').classList.add('active');
                });
            });

            // Botões de conta e histórico
            el('#accountBtn').addEventListener('click', () => {
                showPage('account');
                elAll('.nav-link').forEach(l => l.classList.remove('active'));
                el('.nav-link[data-page="account"]').classList.add('active');
            });

            el('#historyBtn').addEventListener('click', () => {
                showPage('history');
                elAll('.nav-link').forEach(l => l.classList.remove('active'));
                el('.nav-link[data-page="history"]').classList.add('active');
            });

            // Adicionar jogo (admin)
            el('#add-game-btn').addEventListener('click', () => {
                showAddGameModal();
            });

            // Botões do admin
            el('#save-promo').addEventListener('click', savePromotion);
            el('#export-games').addEventListener('click', exportGamesData);
        }

        function showPage(page) {
            // Esconder todas as páginas
            elAll('.page').forEach(p => p.classList.remove('active'));
            
            // Mostrar a página solicitada
            el(`#${page}-page`).classList.add('active');
            state.currentPage = page;
            
            // Atualizar conteúdo específico da página
            if (page === 'favorites') {
                renderFavorites();
            } else if (page === 'history') {
                renderHistory();
            } else if (page === 'account') {
                renderAccount();
            } else if (page === 'admin') {
                if (!state.adminLoggedIn) {
                    el('#admin-login').style.display = 'block';
                    el('#admin-panel').style.display = 'none';
                } else {
                    el('#admin-login').style.display = 'none';
                    el('#admin-panel').style.display = 'block';
                    renderAdmin();
                }
            } else if (page === 'home') {
                renderPromoGames();
            }
        }

        function switchAccountTab(tabName) {
            // Esconder todas as abas
            elAll('#account-page .tab-content').forEach(t => t.classList.remove('active'));
            elAll('#account-page .tab').forEach(t => t.classList.remove('active'));
            
            // Mostrar a aba solicitada
            el(`#${tabName}-tab`).classList.add('active');
            el(`#account-page .tab[data-tab="${tabName}"]`).classList.add('active');
        }

        function switchAdminTab(tabName) {
            // Esconder todas as abas
            elAll('#admin-page .tab-content').forEach(t => t.classList.remove('active'));
            elAll('#admin-page .tab').forEach(t => t.classList.remove('active'));
            
            // Mostrar a aba solicitada
            el(`#${tabName}-tab`).classList.add('active');
            el(`#admin-page .tab[data-tab="${tabName}"]`).classList.add('active');
        }

        function switchCheckoutTab(tabName) {
            // Esconder todas as abas
            elAll('#checkout-modal .tab-content').forEach(t => t.classList.remove('active'));
            elAll('#checkout-modal .tab').forEach(t => t.classList.remove('active'));
            
            // Mostrar a aba solicitada
            el(`#${tabName}-tab`).classList.add('active');
            el(`#checkout-modal .tab[data-tab="${tabName}"]`).classList.add('active');
            
            if (tabName === 'review') {
                renderReview();
            }
        }

        function renderFavorites() {
            const wrap = el('#favorites-list');
            wrap.innerHTML = '';
            
            if (state.favorites.length === 0) {
                wrap.innerHTML = '<div class="muted" style="text-align:center;padding:40px">Nenhum jogo favoritado ainda.</div>';
                return;
            }
            
            state.favorites.forEach(favId => {
                const game = GAMES.find(g => g.id === favId);
                if (game) {
                    const discount = game.originalPrice ? Math.round(((game.originalPrice - game.price) / game.originalPrice) * 100) : 0;
                    
                    const c = document.createElement('div'); 
                    c.className = 'card';
                    c.innerHTML = `
                        ${game.onSale ? `<div class="promo-badge">-${discount}%</div>` : ''}
                        <button class="favorite-btn active" data-fav="${game.id}">
                            ❤
                        </button>
                        <img src="${game.img}" alt="${game.title}">
                        <div class="meta">
                            <div class="title">${game.title}</div>
                            <div class="small muted">${game.genre} · ${renderStars(game.rating)} ${game.rating}</div>
                            <div class="price">
                                ${game.originalPrice ? `<span class="original-price">R$ ${game.originalPrice.toFixed(2)}</span>` : ''}
                                R$ ${game.price.toFixed(2)}
                                ${game.originalPrice ? `<div class="discount">-${discount}%</div>` : ''}
                            </div>
                            <div class="card-actions">
                                <button class="btn" data-id="${game.id}">Adicionar</button>
                                <button class="icon-btn" data-view="${game.id}">Ver</button>
                            </div>
                        </div>
                    `;
                    wrap.appendChild(c);
                }
            });
        }

        function renderHistory() {
            const wrap = el('#history-list');
            wrap.innerHTML = '';
            
            if (state.orders.length === 0) {
                wrap.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:20px">Nenhum pedido encontrado.</td></tr>';
                return;
            }
            
            // Filtrar pedidos do usuário atual (se logado)
            let userOrders = state.orders;
            if (state.currentUser) {
                userOrders = state.orders.filter(order => order.userId === state.currentUser.id);
            }
            
            if (userOrders.length === 0) {
                wrap.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:20px">Nenhum pedido encontrado.</td></tr>';
                return;
            }
            
            userOrders.forEach(order => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${new Date(order.date).toLocaleDateString('pt-BR')}</td>
                    <td>#${order.id}</td>
                    <td>${order.items.length} jogo(s)</td>
                    <td>R$ ${order.total.toFixed(2)}</td>
                    <td><span class="badge">${order.status}</span></td>
                `;
                wrap.appendChild(tr);
            });
        }

        function renderAccount() {
            const profileInfo = el('#profile-info');
            
            if (state.currentUser) {
                profileInfo.innerHTML = `
                    <div class="form-group">
                        <label>Nome</label>
                        <div class="form-control">${state.currentUser.name}</div>
                    </div>
                    <div class="form-group">
                        <label>E-mail</label>
                        <div class="form-control">${state.currentUser.email}</div>
                    </div>
                    <div class="form-group">
                        <label>Data de Registro</label>
                        <div class="form-control">${new Date(state.currentUser.registered).toLocaleDateString('pt-BR')}</div>
                    </div>
                    <button class="btn secondary" id="logout-btn">Sair</button>
                `;
                
                el('#logout-btn').addEventListener('click', logout);
            } else {
                profileInfo.innerHTML = '<p class="muted">Faça login para ver suas informações.</p>';
            }
        }

        function renderAdmin() {
            // Atualizar estatísticas
            el('#admin-total-games').textContent = GAMES.length;
            el('#admin-total-users').textContent = state.users.length;
            el('#admin-total-orders').textContent = state.orders.length;
            
            const totalRevenue = state.orders.reduce((sum, order) => sum + order.total, 0);
            el('#admin-total-revenue').textContent = `R$ ${totalRevenue.toFixed(2)}`;
            
            // Jogos
            const gamesList = el('#admin-games-list');
            gamesList.innerHTML = '';
            
            GAMES.forEach(game => {
                const discount = game.originalPrice ? Math.round(((game.originalPrice - game.price) / game.originalPrice) * 100) : 0;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${game.id}</td>
                    <td><img src="${game.img}" alt="${game.title}" style="width:50px;height:30px;object-fit:cover"></td>
                    <td>${game.title}</td>
                    <td>${game.genre}</td>
                    <td>R$ ${game.price.toFixed(2)}</td>
                    <td>${game.onSale ? `${discount}%` : '-'}</td>
                    <td>${renderStars(game.rating)} ${game.rating}</td>
                    <td>
                        <button class="icon-btn" data-edit="${game.id}"><i class="fas fa-edit"></i></button>
                        <button class="icon-btn" data-delete="${game.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                gamesList.appendChild(tr);
            });
            
            // Pedidos
            const ordersList = el('#admin-orders-list');
            ordersList.innerHTML = '';
            
            if (state.orders.length === 0) {
                ordersList.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:20px">Nenhum pedido encontrado.</td></tr>';
            } else {
                state.orders.forEach(order => {
                    const user = state.users.find(u => u.id === order.userId) || {name: 'Cliente', email: 'N/A'};
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>#${order.id}</td>
                        <td>${user.name}<br><small class="muted">${user.email}</small></td>
                        <td>${new Date(order.date).toLocaleDateString('pt-BR')}</td>
                        <td>R$ ${order.total.toFixed(2)}</td>
                        <td><span class="badge">${order.status}</span></td>
                        <td>
                            <button class="icon-btn" data-view-order="${order.id}"><i class="fas fa-eye"></i></button>
                        </td>
                    `;
                    ordersList.appendChild(tr);
                });
            }
            
            // Usuários
            const usersList = el('#admin-users-list');
            usersList.innerHTML = '';
            
            if (state.users.length === 0) {
                usersList.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:20px">Nenhum usuário encontrado.</td></tr>';
            } else {
                state.users.forEach(user => {
                    // Calcular total gasto pelo usuário
                    const userOrders = state.orders.filter(order => order.userId === user.id);
                    const totalSpent = userOrders.reduce((sum, order) => sum + order.total, 0);
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${new Date(user.registered).toLocaleDateString('pt-BR')}</td>
                        <td>R$ ${totalSpent.toFixed(2)}</td>
                        <td>
                            <button class="icon-btn" data-edit-user="${user.id}"><i class="fas fa-edit"></i></button>
                        </td>
                    `;
                    usersList.appendChild(tr);
                });
            }
            
            // Promoções
            renderActivePromotions();
        }
        
        function renderActivePromotions() {
            const wrap = el('#active-promotions');
            wrap.innerHTML = '';
            
            if (PROMOTIONS.length === 0) {
                wrap.innerHTML = '<div class="muted" style="text-align:center;padding:20px">Nenhuma promoção ativa.</div>';
                return;
            }
            
            PROMOTIONS.forEach(promo => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div class="meta">
                        <div class="title">${promo.name}</div>
                        <div class="small muted">${promo.discount}% de desconto</div>
                        <div class="small muted">Válida até: ${new Date(promo.end).toLocaleDateString('pt-BR')}</div>
                        <div class="card-actions">
                            <button class="btn secondary" data-edit-promo="${promo.id}">Editar</button>
                            <button class="icon-btn" data-delete-promo="${promo.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
                wrap.appendChild(div);
            });
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = el('#login-email').value;
            const password = el('#login-password').value;
            
            const user = state.users.find(u => u.email === email && u.password === password);
            
            if (user) {
                state.currentUser = user;
                localStorage.setItem('current_user', JSON.stringify(user));
                showToast('Login realizado com sucesso!');
                renderAccount();
                switchAccountTab('profile');
            } else {
                showToast('E-mail ou senha incorretos!');
            }
        }

        function handleAdminLogin(e) {
            e.preventDefault();
            const password = el('#admin-password').value;
            
            if (password === state.adminPassword) {
                state.adminLoggedIn = true;
                el('#admin-login').style.display = 'none';
                el('#admin-panel').style.display = 'block';
                renderAdmin();
                showToast('Acesso administrativo concedido!');
            } else {
                showToast('Senha de administrador incorreta!');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = el('#register-name').value;
            const email = el('#register-email').value;
            const password = el('#register-password').value;
            const confirm = el('#register-confirm').value;
            
            if (password !== confirm) {
                showToast('As senhas não coincidem!');
                return;
            }
            
            if (state.users.find(u => u.email === email)) {
                showToast('Este e-mail já está em uso!');
                return;
            }
            
            const newUser = {
                id: Date.now(),
                name,
                email,
                password,
                registered: new Date().toISOString()
            };
            
            state.users.push(newUser);
            localStorage.setItem('users_demo', JSON.stringify(state.users));
            
            state.currentUser = newUser;
            localStorage.setItem('current_user', JSON.stringify(newUser));
            
            showToast('Conta criada com sucesso!');
            renderAccount();
            switchAccountTab('profile');
        }

        function logout() {
            state.currentUser = null;
            localStorage.removeItem('current_user');
            showToast('Logout realizado!');
            renderAccount();
            switchAccountTab('login');
        }

        function applyCoupon() {
            const code = el('#couponCode').value.trim().toUpperCase();
            const coupon = COUPONS.find(c => c.code === code && c.valid);
            
            if (!coupon) {
                el('#couponMessage').textContent = 'Cupom inválido ou expirado.';
                el('#couponMessage').style.color = '#ef4444';
                return;
            }
            
            // Verificar valor mínimo
            const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            if (subtotal < coupon.minValue) {
                el('#couponMessage').textContent = `Valor mínimo para este cupom: R$ ${coupon.minValue.toFixed(2)}`;
                el('#couponMessage').style.color = '#ef4444';
                return;
            }
            
            state.appliedCoupon = coupon;
            el('#couponMessage').textContent = `Cupom aplicado: ${coupon.discount}% de desconto!`;
            el('#couponMessage').style.color = '#10b981';
            
            // Recalcular carrinho
            renderCart();
        }
        
        function applyCartCoupon() {
            const code = el('#cart-coupon').value.trim().toUpperCase();
            const coupon = COUPONS.find(c => c.code === code && c.valid);
            
            if (!coupon) {
                el('#cart-coupon-message').textContent = 'Cupom inválido ou expirado.';
                el('#cart-coupon-message').style.color = '#ef4444';
                return;
            }
            
            // Verificar valor mínimo
            const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            if (subtotal < coupon.minValue) {
                el('#cart-coupon-message').textContent = `Valor mínimo: R$ ${coupon.minValue.toFixed(2)}`;
                el('#cart-coupon-message').style.color = '#ef4444';
                return;
            }
            
            state.appliedCoupon = coupon;
            el('#cart-coupon-message').textContent = `Cupom aplicado: ${coupon.discount}% de desconto!`;
            el('#cart-coupon-message').style.color = '#10b981';
            
            // Recalcular carrinho
            renderCart();
        }

        function openCheckout() {
            if (!state.currentUser) {
                showToast('Faça login para finalizar a compra!');
                showPage('account');
                return;
            }
            
            el('#checkout-modal').classList.add('open');
            switchCheckoutTab('address');
        }

        function closeCheckout() {
            el('#checkout-modal').classList.remove('open');
        }

        function renderReview() {
            const itemsWrap = el('#review-items');
            itemsWrap.innerHTML = '';
            
            state.cart.forEach(item => {
                const div = document.createElement('div');
                div.style.display = 'flex';
                div.style.justifyContent = 'space-between';
                div.style.marginBottom = '10px';
                div.innerHTML = `
                    <div>${item.title} (${item.qty}x)</div>
                    <div>R$ ${(item.price * item.qty).toFixed(2)}</div>
                `;
                itemsWrap.appendChild(div);
            });
            
            const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const discount = state.appliedCoupon ? (subtotal * state.appliedCoupon.discount / 100) : 0;
            const total = subtotal - discount;
            
            el('#review-subtotal').textContent = `R$ ${subtotal.toFixed(2)}`;
            el('#review-discount').textContent = `- R$ ${discount.toFixed(2)}`;
            el('#review-total').textContent = `R$ ${total.toFixed(2)}`;
        }

        function confirmPurchase() {
            if (state.cart.length === 0) {
                showToast('Seu carrinho está vazio!');
                return;
            }
            
            const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const discount = state.appliedCoupon ? (subtotal * state.appliedCoupon.discount / 100) : 0;
            const total = subtotal - discount;
            
            const newOrder = {
                id: Date.now(),
                userId: state.currentUser.id,
                date: new Date().toISOString(),
                items: [...state.cart],
                subtotal,
                discount,
                total,
                status: 'Processando'
            };
            
            state.orders.push(newOrder);
            localStorage.setItem('orders_demo', JSON.stringify(state.orders));
            
            // Limpar carrinho
            state.cart = [];
            state.appliedCoupon = null;
            state.cartDiscount = 0;
            saveCart();
            renderCart();
            
            closeCheckout();
            showToast('Compra realizada com sucesso!');
            
            // Se estiver na página de histórico, atualizar
            if (state.currentPage === 'history') {
                renderHistory();
            }
        }

        function addToCart(game) {
            const found = state.cart.find(i => i.id === game.id);
            if (found) found.qty += 1; 
            else state.cart.push({...game, qty: 1});
            
            saveCart(); 
            renderCart();
            showToast(`${game.title} adicionado ao carrinho!`);
            
            // Efeito visual no botão do carrinho
            el('#openCart').classList.add('pulse');
            setTimeout(() => {
                el('#openCart').classList.remove('pulse');
            }, 1000);
        }

        function toggleFavorite(gameId) {
            const index = state.favorites.indexOf(gameId);
            if (index > -1) {
                state.favorites.splice(index, 1);
                showToast('Jogo removido dos favoritos');
            } else {
                state.favorites.push(gameId);
                showToast('Jogo adicionado aos favoritos');
            }
            localStorage.setItem('favorites_demo', JSON.stringify(state.favorites));
            
            // Se estiver na página de favoritos, atualizar
            if (state.currentPage === 'favorites') {
                renderFavorites();
            }
        }

        function saveCart() { 
            localStorage.setItem('cart_demo', JSON.stringify(state.cart)); 
        }

        function renderCart() {
            el('#cartCount').textContent = state.cart.reduce((s, i) => s + i.qty, 0);
            const wrap = el('#cartItems');
            wrap.innerHTML = '';
            
            if (state.cart.length === 0) {
                wrap.innerHTML = '<div class="muted" style="text-align:center;padding:20px">Carrinho vazio</div>';
                el('#cartDiscount').textContent = '';
            } else {
                state.cart.forEach(it => {
                    const div = document.createElement('div');
                    div.className = 'row-item';
                    div.innerHTML = `
                        <div>
                            <div style="font-weight:700">${it.title}</div>
                            <div class="muted">${it.qty} x R$ ${it.price.toFixed(2)}</div>
                        </div>
                        <div>
                            <button class="icon-btn" data-remove="${it.id}">Remover</button>
                        </div>
                    `;
                    wrap.appendChild(div);
                });

                // bind remove
                el('#cartItems').querySelectorAll('[data-remove]').forEach(btn => btn.addEventListener('click', e => { 
                    const id = +e.target.dataset.remove; 
                    state.cart = state.cart.filter(x => x.id !== id); 
                    saveCart(); 
                    renderCart();
                    showToast('Item removido do carrinho');
                }));
            }

            const subtotal = state.cart.reduce((s, i) => s + i.price * i.qty, 0);
            const discount = state.appliedCoupon ? (subtotal * state.appliedCoupon.discount / 100) : 0;
            const total = subtotal - discount;
            
            el('#cartTotal').textContent = 'R$ ' + total.toFixed(2);
            
            if (state.appliedCoupon) {
                el('#cartDiscount').textContent = `Desconto de ${state.appliedCoupon.discount}% aplicado!`;
            } else {
                el('#cartDiscount').textContent = '';
            }
        }

        function toggleCart() { 
            el('#cart').classList.toggle('open'); 
        }

        function openModal(game) { 
            el('#modalImg').src = game.img; 
            el('#modalTitle').textContent = game.title; 
            el('#modalGenre').textContent = game.genre; 
            
            if (game.originalPrice) {
                const discount = Math.round(((game.originalPrice - game.price) / game.originalPrice) * 100);
                el('#modalPrice').innerHTML = `
                    <span class="original-price">R$ ${game.originalPrice.toFixed(2)}</span>
                    R$ ${game.price.toFixed(2)}
                `;
                el('#modalDiscount').textContent = `${discount}% de desconto!`;
            } else {
                el('#modalPrice').textContent = 'R$ ' + game.price.toFixed(2);
                el('#modalDiscount').textContent = '';
            }
            
            el('#modalRating').textContent = `${game.rating} (${game.userRatings || 0} avaliações)`;
            el('#modalDesc').textContent = game.desc; 
            el('#modal').classList.add('open'); 
            el('#modalBuy').dataset.id = game.id;
            el('#modalFav').classList.toggle('active', state.favorites.includes(game.id));
            
            // Configurar avaliações
            setupRatings(game);
            
            // Mostrar/ocultar seção de avaliação do usuário
            if (state.currentUser) {
                el('#userRatingSection').style.display = 'block';
            } else {
                el('#userRatingSection').style.display = 'none';
            }
        }
        
        function setupRatings(game) {
            // Estatísticas de avaliação
            const ratingBars = el('#ratingBars');
            ratingBars.innerHTML = '';
            
            // Calcular distribuição de avaliações
            const ratingCounts = [0, 0, 0, 0, 0];
            game.ratings.forEach(rating => {
                if (rating >= 1 && rating <= 5) {
                    ratingCounts[Math.floor(rating) - 1]++;
                }
            });
            
            const totalRatings = game.ratings.length;
            
            // Criar barras de avaliação
            for (let i = 5; i >= 1; i--) {
                const count = ratingCounts[i - 1];
                const percentage = totalRatings > 0 ? (count / totalRatings) * 100 : 0;
                
                const barDiv = document.createElement('div');
                barDiv.className = 'rating-stats';
                barDiv.innerHTML = `
                    <div>${i} ★</div>
                    <div class="rating-bar">
                        <div class="rating-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div>${count}</div>
                `;
                ratingBars.appendChild(barDiv);
            }
            
            // Atualizar contador
            el('#ratingCount').textContent = `${totalRatings} avaliação${totalRatings !== 1 ? 'ões' : ''}`;
            
            // Configurar estrelas de avaliação do usuário
            const userRatingStars = el('#userRatingStars');
            userRatingStars.innerHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('span');
                star.className = 'star';
                star.dataset.rating = i;
                star.textContent = '☆';
                star.addEventListener('click', () => rateGame(game.id, i));
                userRatingStars.appendChild(star);
            }
            
            // Verificar se o usuário já avaliou este jogo
            if (state.currentUser) {
                const userRating = game.ratings.find((r, index) => 
                    game.ratingUsers && game.ratingUsers[index] === state.currentUser.id
                );
                
                if (userRating) {
                    highlightUserRating(userRating);
                    el('#userRatingText').textContent = `Você avaliou com ${userRating} estrelas`;
                } else {
                    el('#userRatingText').textContent = 'Clique nas estrelas para avaliar';
                }
            }
        }
        
        function rateGame(gameId, rating) {
            if (!state.currentUser) {
                showToast('Faça login para avaliar jogos!');
                return;
            }
            
            const game = GAMES.find(g => g.id === gameId);
            if (!game) return;
            
            // Verificar se o usuário já avaliou
            const existingRatingIndex = game.ratingUsers ? 
                game.ratingUsers.findIndex(userId => userId === state.currentUser.id) : -1;
            
            if (existingRatingIndex !== -1) {
                // Atualizar avaliação existente
                game.ratings[existingRatingIndex] = rating;
            } else {
                // Adicionar nova avaliação
                if (!game.ratings) game.ratings = [];
                if (!game.ratingUsers) game.ratingUsers = [];
                
                game.ratings.push(rating);
                game.ratingUsers.push(state.currentUser.id);
            }
            
            // Recalcular avaliação média
            game.userRatings = game.ratings.length;
            game.rating = (game.ratings.reduce((a, b) => a + b, 0) / game.ratings.length).toFixed(1);
            
            // Salvar no localStorage
            localStorage.setItem(`game_ratings_${gameId}`, JSON.stringify(game.ratings));
            localStorage.setItem(`game_rating_users_${gameId}`, JSON.stringify(game.ratingUsers || []));
            
            // Atualizar interface
            highlightUserRating(rating);
            el('#userRatingText').textContent = `Você avaliou com ${rating} estrelas`;
            el('#modalRating').textContent = `${game.rating} (${game.userRatings} avaliações)`;
            
            // Atualizar estatísticas
            setupRatings(game);
            
            showToast('Avaliação enviada com sucesso!');
        }
        
        function highlightUserRating(rating) {
            const stars = elAll('#userRatingStars .star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.textContent = '★';
                    star.style.color = '#ffd700';
                } else {
                    star.textContent = '☆';
                    star.style.color = '#ffd700';
                }
            });
        }
        
        function closeModal() { 
            el('#modal').classList.remove('open'); 
        }

        function showToast(message) {
            const toast = el('#toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        function startPromoTimer() {
            const timer = setInterval(() => {
                const hours = Math.floor(state.promoTimeRemaining / 3600);
                const minutes = Math.floor((state.promoTimeRemaining % 3600) / 60);
                const seconds = state.promoTimeRemaining % 60;
                
                el('#promoTimer').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                state.promoTimeRemaining--;
                localStorage.setItem('promo_time_remaining', state.promoTimeRemaining);
                
                if (state.promoTimeRemaining < 0) {
                    clearInterval(timer);
                    el('#promoTimer').textContent = 'Promoção encerrada!';
                }
            }, 1000);
        }
        
        function savePromotion() {
            const name = el('#promo-name').value;
            const discount = parseInt(el('#promo-discount').value);
            const gameIds = el('#promo-games').value.split(',').map(id => parseInt(id.trim()));
            const start = el('#promo-start').value;
            const end = el('#promo-end').value;
            
            if (!name || !discount || gameIds.length === 0 || !start || !end) {
                showToast('Preencha todos os campos!');
                return;
            }
            
            const newPromo = {
                id: Date.now(),
                name,
                discount,
                gameIds,
                start,
                end
            };
            
            PROMOTIONS.push(newPromo);
            localStorage.setItem('promotions_demo', JSON.stringify(PROMOTIONS));
            
            // Aplicar promoção aos jogos
            gameIds.forEach(id => {
                const game = GAMES.find(g => g.id === id);
                if (game) {
                    game.originalPrice = game.price;
                    game.price = game.price * (1 - discount / 100);
                    game.onSale = true;
                }
            });
            
            showToast('Promoção criada com sucesso!');
            renderActivePromotions();
            renderStore();
            renderPromoGames();
        }
        
        function exportGamesData() {
            const dataStr = JSON.stringify(GAMES, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'games_data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Dados exportados com sucesso!');
        }

        // inicializar
        init();
    </script>
</body>
</html>
